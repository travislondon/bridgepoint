
---

This work is licensed under the Creative Commons CC0 License

---

# Provide prototypes for specified issues
### xtUML Project Implementation Note

### 1. Abstract

This note describes the changes required to prototype each issue listed in the document references.  Where an analysis was previously performed it shall be followed.  In the case where an analysis was not performed this note may be used to aid in full analysis if required.

### 2. Document References

<a id="2.1"></a>2.1 [BridgePoint DEI #4896](https://support.onefact.net/issues/4896) Not possible to specify datatypes with the same name at different levels.  
<a id="2.2"></a>2.2 [BridgePoint DEI #5005](https://support.onefact.net/issues/5005) Ranges of data types.  
<a id="2.3"></a>2.3 [BridgePoint DEI #5106](https://support.onefact.net/issues/5106) Constant based on user data type.  
<a id="2.4"></a>2.4 [BridgePoint DEI #9050](https://support.onefact.net/issues/9050) Element order is inconsistent between ME and canvas for constants.  
<a id="2.5"></a>2.5 [BridgePoint DEI #4859](https://support.onefact.net/issues/4859) Class-based operations in a class are not clearly distinguishable from instance-based operations. They appear in the same way. In BridgePoint 6.1 they were underlined to distinguish them form instance-based operations. This is the UML standard notation.  
<a id="2.3"></a>2.6 [BridgePoint DEI #5035](https://support.onefact.net/issues/5035) Open source object when clicking on imported/delegated/referenced elements (classes, signals, operations) as for component references.  

### 3. Background

See issue database.

### 4. Requirements

4.1 Follow requirements of analysis where available.

### 5. Work Required

5.1 Scoped enumerations  

For this prototype the analysis was strayed from a bit.  There are a couple of reasons, one is that it is simpler to use the first collected data type for "closest to".  Another reason is that two types in two different packages should be unique.  And finally, to prevent true conflicts with types the tool is modified to disallow creation or renaming of types to the same name within the same package.  Older models that had conflicting type will have parse errors now.    

UIUtil.validateNameUsingRenameAction() is modified to check for naming conflicts on:

* S_UDT  
* S_EDT  
* S_SDT  
* CNST_LSC  

Naming conflicts are prevented during creation and renaming.  This is done in UIUtil.validateNameUsingRenameAction() and RenameAction.isNameValid().  Pre-existing conflicts will have had parse errors and not been executable.  Such models shall be left as is, leaving the integrity checker to warn of such issues.  

The function, Scoped_data_type_validate, is modified to only consider the first result in the search set.  The first instance found for either EDT or CSP are used.  In the case of both existing the EDT is given preference.

There is a problem that would is not addressed by this work or would not be with the original analysis.  Getting rid of the parse issues is only one part of the overall scoping issue.  Id's of parameter types and return types are checked when set to an EDT.  Therefore, in the original test case the event parameters will still have to be set to the first in-scope EDT.  Without the parameters being set to the appropriate EDT this parse error is thrown:  

Incompatiable operands for relational expression  

5.2 Ranges for UDTs

5.2.1 Add Range class

A new class Range is added to the Domain package under ooaofooa.  This class has a conditional one to one relationship according to the analysis note for [2.2](#2.2).

A Rance may have a minumum and maximum value.  These are added as attributes min and max.  The new attributes are set as real to handle the full minumum and maximum values.  The UI handles validation with type determination, integer versus float.

This same change is made to both ooaofooa and mcooa.

5.2.2 UI Range configuration

A new menu along with three sub menus are added.  These are:

* Range
* Range > Minimum...
* Range > Maximum...
* Range > Clear Range

The Range top level menu shows as long as the selection contians only UDTs that have a core type of integer, real or Enumeration Data Type.  The Clear Range menu item will only show as long as one of the selected User Data Types has a Range associated already.  The Range menu will not show when mixing integer or enumeration data type with real.  This is due to the fact that a real value can be invalid for an integer value.

The Minumum... and Maximum... menu items open an input dialog.  This dialog assures that the input value is valid.  In the case of integer the string value is parsed.  If a NumberFormatException is thrown a message is given indicating an invalid entry.  In the case of a float the value is parsed and the given float is checked for NaN and infinite exceptions.  The same message is given for the invalid float.

5.2.3 Add range data to compare and persistence

Three new entries are added to ooaofooa_hierarchy.pei.sql to cover external attributes for the UDT class.  An external attribute is used to display an attribute from another class under the one associated.  In this case the min and max values from the Range class associated with the User Data Type.  This change allows the range values to show in compare.  Note like Visibilty these are not available in the properties view.  More work is required to support such a change.

The file_io.pei and stream.pei data is modified to add a new child to User Data Type, Range.

5.3 Allow UDTs as constants  

To relax constant type assignment the canUseDataType() operation in Literal Symbolic Constant is modified.  The operation now checks that for an EDT or UDT.  In the case of a UDT the core data type is located recursively.  In all cases if the DT subtype is EDT the type is allowed for assignment.  The new OAL is below:  

```
	select one edt related by dt->S_EDT[R17];
	if(not_empty edt)
	  return true;
	end if;
    select one udt related by dt->S_UDT[R17];
    if(not_empty udt)
      coreId = udt.getCoreType();
      select any dt from instances of S_DT where (selected.DT_ID == coreId);
      select one edt related by dt->S_EDT[R17];
      if(not_empty edt)
        return true;
      end if;
    end if;
```

The class ConstanceValueInputValidator is modified to called the same recursion as above when dealing with a UDT.  

Verifier handles constants in all cases even for EDTs, no changes are required.  

### 6. Implementation Comments

None.

### 7. Unit Test

7.2 Ranges for UDTs  Â 
7.2.1 Menu Item  
7.2.1.1 Selection (No previous range)  
7.2.1.1.1 UDT  
7.2.1.1.R Range > Minimum... available  
7.2.1.1.R Range > Maximum... available  
7.2.1.1.R Range > Clear Range not available  
7.2.1.1.1 Select Minimum...  
7.2.1.1.R Dialog opens with no value listed  
7.2.1.1.2 Select Maximum...  
7.2.1.1.R Dialog opens with no value listed  
7.2.1.2 Selection (Previous range)  
7.2.1.2.R Range > Minimum... available  
7.2.1.2.R Range > Maximum... available  
7.2.1.2.R Range > Clear Range available  
7.2.1.2.1 Select Minimum...  
7.2.1.2.R Dialog opens with previous min value listed  
7.2.1.2.2 Select Maximum...  
7.2.1.2.R Dialog opens with previous max value listed  
7.2.1.2.3 Select Clear Range  
7.2.1.2.R Range > Clear Range not available  
7.2.1.3 Selection (mixed integer and real)  
7.2.1.R Range not available  
7.2.2 Undo/Redo and Persistence  
7.2.2.1 Minimum  
7.2.2.1.1 Set minumum value  
7.2.2.1.2 Compare with local history  
7.2.2.1.R Minimum value is changed  
7.2.2.1.3 Undo  
7.2.2.1.4 Compare with local history  
7.2.2.1.R Minimum value reverted  

7.3 Literal Symbolic Constant UDT  
7.3.1 Where a UDT exists as: UDT > UDT > EDT  
7.3.1.1 Right click on an LSC and select Set Type...  
7.3.1.R The UDT is listed as a possibility  
7.3.2 Where an EDT exists  
7.3.2.1 Right click on an LSC and select Set Type...  
7.3.2.R The UDT is listed as a possibility  
7.3.3 Where an EDT is assigned to a constance  
7.3.3.1 Right click and select Set Value...  
7.3.3.2 Insert <edt_name>::<enum>  
7.3.3.R OK is allowed  

### 8. User Documentation

Describe the end user documentation that was added for this change.

### 9. Code Changes

Fork/Repository: < enter your fork and repo name name >  
Branch: < enter your branch name here >  

<pre>

Put the file list here

</pre>

### End

